<p>ランキング</p>
<% lastFavorite = 0 %>
<% j = 1 %>

<% @ranks.each.with_index(1) do |(key,val),i| %>
  <%= link_to  record_tournament_post_path(tournament_id: @tournament, id: key[:post_id]) do %>

    <% if @tournament.main_rule == "合計長さで勝負" %>
      <% rank = key[:sum_size] %>
    <% elsif @tournament.main_rule == "デカイもん勝ち" %>
      <% rank = key[:max_size] %>
    <% elsif @tournament.main_rule == "とにかく数を釣れ" %>
      <% rank = key[:count] %>
    <% else %>
    <% end %>

    <% if i == 1 %>
      <% lastFavorite = rank %>
    <% end %>

    <% if rank != lastFavorite %>
      <% j = i %>

      <p><%= "第#{j}位　#{key[:nickname]}" %></p>
      <p><%= "合計サイズ：　#{key[:sum_size]}cm" %></p>
      <p><%= "最大サイズ：　#{key[:max_size]}cm" %></p>
      <p><%= "有効釣果数：　#{key[:count]}匹" %></p>
      <%= image_tag "#{key[:max_size_image]}" %>
      <% lastFavorite = rank %>
    <% else %>
      <% lastFavorite = rank %>
      <p><%= "第#{j}位　#{key[:nickname]}" %></p>
      <p><%= "合計サイズ：　#{key[:sum_size]}cm" %></p>
      <p><%= "最大サイズ：　#{key[:max_size]}cm" %></p>
      <p><%= "有効釣果数：　#{key[:count]}匹" %></p>
      <%= image_tag "#{key[:max_size_image]}" %>
    <% end %>

  <% end %>
<% end %>
